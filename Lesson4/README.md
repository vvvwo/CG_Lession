# 三维模型变换

本课程介绍OpenGL是如何处理模型-全局-观察矩阵变换，包括齐次坐标变换、观察矩阵计算以及在顶点着色器里的流水线处理。可以说这部分是OpenGL前半部分最重要的知识点。如果你希望完成FPS游戏Demo，那么你必须要熟练掌握模型变换的数学基础以及在OpenGL的处理流程，尤其是在顶点着色器中的几个矩阵变换。一旦熟练掌握，那么处理复杂的三维变换计算将会变得非常容易！

## 1. 齐次坐标变换

如果你对线性代数和矩阵计算稍有了解，那么你应该了解，如果我们希望对一个点添加一个变换，那么这个变换可以以矩阵乘法的形式执行。譬如存在一个点p(x,y,z), 我希望将点进行一个以原点为起点的拉伸，拉伸的倍数为a。我们最终希望获得的坐标是p(ax,ay,az)。这个拉伸过程就可以被看做是一个变换，自然这个变换能够被写成矩阵计算的形式：

<img height = "100" alt="equ" src="https://github.com/user-attachments/assets/1b532cdc-634e-4493-b877-6834e5bbc4ef">

除此之外，我们还能将点p按照一个特定的轴进行旋转（绕Z轴旋转，角度为θ1）：

<img height = "100" alt="fig1" src="https://github.com/user-attachments/assets/ca83e5bd-c1e3-4658-86bb-26f621ada072">

<img height ="100" alt="equ2" src="https://github.com/user-attachments/assets/5f2b4e6f-b71b-4087-a171-96f853a94651">

绕其他两轴的变换矩阵也是类似的，这里我直接写出来：

（绕X轴旋转，角度为θ1）：

<img height = "100" alt="fig2" src="https://github.com/user-attachments/assets/792a9059-53fa-4307-95f4-ee823fcc5a3f">

（绕Y轴旋转，角度为θ1）：

<img height = "100" alt="fig3" src="https://github.com/user-attachments/assets/e4473117-f2f1-47eb-9345-a84171be91c2">

我们知道，基础变换是包含平移、旋转和缩放的，平移可以写成如下形式：

<img height = "33" alt="fig4" src="https://github.com/user-attachments/assets/f4c1d1c3-3e8b-42c6-8016-7c30b17c4990">

这里有一个问题，平移是以矩阵加法的形式执行的，缩放和旋转则是矩阵乘法的形式来执行的。当我们需要组合各种复杂的变换来驱动对应的三维计算或动画模拟时，我们显然希望统一矩阵计算形式，这样在顶点着色器中处理更加容易。另外，我们还需要区分当前的数据是一个点，还是一个向量，此时如果按照三维空间的三坐标形式来建立变换矩阵和数据表达，就不能满足要求。齐次坐标就是用来解决这个问题，其形式就是增加一维，使得点的坐标从三维扩展到四维，变换矩阵变为4*4，这样，所有的变换都能够写成矩阵乘法，平移变为：

<img height = "133" alt="fig3" src="https://github.com/user-attachments/assets/dd506f28-c74a-4e50-a5c1-8b0cc8d2d57e">

点的最后一位为1，向量的最后一位为0，这样点和向量（或平移变换）的计算就不会改变标识位，使得计算保持形式上的统一。

$${\color{red}注：在实际的计算中，矩阵是前置的，因此会与我的写法有一些不同，但是只要了解原理，变换计算顺序不会影响你对齐次坐标变换的理解。}$$

## 2. 观察矩阵



## 3. 顶点着色器矩阵变换

